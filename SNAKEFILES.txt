# Define the input fastq files
SAMPLES = ["barcode07", "barcode16"] 

rule all:
    input:
        expand("alignment/{sample}_aligned.bam", sample=SAMPLES)

# Step 1: Adapter Trimming with Porechop
rule porechop:
    input:
        "data/{sample}.fastq"
    output:
        "data/{sample}_trimmed.fastq"
    shell:
        """
        porechop -i {input} -o {output}

# Step 2: Quality Trimming with Trimmomatic
rule trimmomatic:
    input:
        "data/{sample}_trimmed.fastq"
    output:
        "data/{sample}_trimmed_filtered.fastq"
    shell:
        """
        trimmomatic SE -threads 23 -phred33 {input} {output} SLIDINGWINDOW:50:10 MINLEN:100
        """

# Step 3: Reference-based Alignment with Minimap2
rule alignment:
    input:
        "data/{sample}_trimmed_filtered.fastq",
        "reference.fasta"
    output:
        "alignment/{sample}_aligned.bam"
    shell:
        """
        minimap2 -ax map-ont {input[1]} {input[0]} | samtools view -bS | samtools sort -o {output}
        samtools index {output}
        """
